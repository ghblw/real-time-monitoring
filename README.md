##树莓派集群监控系统

####知识点

- socket编程
  - 长短链接传文件
  - ＴＣＰ的建立过程
- 互斥锁
- 多线程

###一、Master端

- 多线程实现，并发度为５，使用５个链表对机器进行任务分配
- 读取配置文件获取监控范围、Ｃｌｉｅｎｔ端监听端口、报警端口、心跳连接端口
- 心跳机制：当收到Ｃｌｉｅｎｔ端发送的心跳连接时，如果链表中不存在该机器地址，则插入节点到长度最短的链表中，Ｃｌｉｅｎｔ端每隔一段时间发送一次心跳连接即关闭连接
- 每个线程遍历自己的链表，主动连接Ｃｌｉｅｎｔ端获取文件，如果连接不上，删除节点，能连接上开始收文件
- 增加删除节点时需要加互斥锁

###二、Client端

- 六个线程并行执行脚本，结果先存放在本地
- 每３０秒发送一次心跳连接，发送后断开连接
- 一个线程执行检测警告信息脚本,发现警告信息和恶意进程实时发送给Ｍａｓｔｅｒ端
- 读写文件需要加互斥锁
- 一个线程等待Ｍａｓｔｅｒ端连接，发送文件

### 三、遇到的问题及解决方案

###四、测试上线

/usr/bin/master_yxw.sh

/usr/bin/master_yxw_stop.sh

/lib/systemd/system/master_yxw.service

开机自启生效：systemctl enable master_yxw.service

关闭：systemctl disable master_yxw.service

###五、优化